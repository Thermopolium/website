<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermopolium</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <header>
        <img src="logo_thermopolium.png" alt="Logo Azienda" class="logo">
        <p class="motto">Gelati, crêpes e tanto altro</p>
    </header>

    <main>
        <section class="avvisi">
            <h2>Avvisi</h2>
            <p>La gelateria di Solduno cambia gestione! Saremo aperti a partire da sabato 7 febbraio 2026.</p>
            <p>Sabato 21 febbraio vi aspettiamo per brindare insieme all'inizio di questa nuova avventura!
        </section>
<!--
        <section class="orari">
            <h2>Orari di apertura</h2>
            <p>Martedì: 14:00 - 19:00</p>
            <p>Mercoledì: 14:00 - 19:00</p>
            <p>Giovedì: 14:00 - 19:00</p>
            <p>Venerdì: 14:00 - 19:00</p>
            <p>Sabato: 14:00 - 19:00</p>
            <p>Domenica: 14:00 - 19:00</p>-->
            <!--<p id="opening-hours">Caricamento orari...</p>--> <!-- FIXME ← questo scarica i dati da OSM, ma bisogna implementare una cache-->
        </section>
<!--
        <section class="social">
            <h2>Seguici sui social</h2>
            <a href="https://www.facebook.com" target="_blank">Facebook</a>
            <a href="https://www.instagram.com" target="_blank">Instagram</a>
            <a href="https://www.twitter.com" target="_blank">Twitter</a>
        </section>
-->
        <section class="bitcoin">
            <h2>Amici di Bitcoin</h2>
            <img src="bitcoin_accepted.png" alt="Bitcoin accepted here">
            <p>Ai bitcoiner vogliamo particolarmente bene: ad essi è riservato uno sconto del 21% su tutti i prodotti in vendita!</p>
        </section>

        <section class="contatti">
            <h2>Contatti</h2>
            <p>Indirizzo: Piazza Solduno, 3, Locarno</p>
            <p>Telefono: +41 76 450 96 70</p>
            <p>Email: info@thermopolium.ch</p>
        </section>

        <div id="map" class="map"></div>
    </main>

    <footer>
        <p>Copyright &copy; 2026 by Thermopolium. All rights reserved.</p>
    </footer>

    <script>
        var map = L.map('map', {attributionControl: false}).setView([46.1702375, 8.7788889], 13);
        var myAttrControl = L.control.attribution().addTo(map);
        myAttrControl.setPrefix('<a href="https://leafletjs.com/">Leaflet</a>');

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        L.marker([46.1702375, 8.7788889]).addTo(map) // Posizione del marker
            .bindPopup('Thermopolium') // Testo del popup
            .openPopup();
    </script>

    <script>
    function fetchOpeningHours() {
        const query = `
            [out:json];
            node[name=Thermopolium](around:10, 46.170237, 8.778892);
            out body;
        `;

        fetch('https://overpass-api.de/api/interpreter?data=' + encodeURIComponent(query))
            .then(response => response.json())
            .then(data => {
                const elements = data.elements;
                if (elements.length > 0 && elements[0].tags && elements[0].tags.opening_hours) {
                    const hours = formatOpeningHours(elements[0].tags.opening_hours);
                    document.getElementById('opening-hours').innerText = hours;
                } else {
                    document.getElementById('opening-hours').innerText = 'Orari non disponibili';
                }
            })
            .catch(error => {
                console.error('Errore nella richiesta:', error);
                document.getElementById('opening-hours').innerText = 'Impossibile recuperare gli orari';
            });
    }

    function formatOpeningHours(hours) {
        const days = hours.split(';').map(hour => hour.trim());
        const formattedHours = [];
        
        days.forEach(day => {
            const [dayRange, hoursRange] = day.split(' ').map(part => part.trim());
            const formattedDays = getFormattedDays(dayRange);
            formattedDays.forEach(formattedDay => {
                formattedHours.push(`${formattedDay}:\t${formatHoursRange(hoursRange)}`);
            });
        });
        
        return formattedHours.join('\n');
    }

    function getFormattedDays(dayRange) {
        const translations = {
            'Mo': 'Lunedì',
            'Tu': 'Martedì',
            'We': 'Mercoledì',
            'Th': 'Giovedì',
            'Fr': 'Venerdì',
            'Sa': 'Sabato',
            'Su': 'Domenica',
        };
        
        let days = [];
        
        if (dayRange.includes('-')) {
            const [startDay, endDay] = dayRange.split('-').map(d => d.trim());
            let currentDay = startDay;

            while (currentDay !== endDay) {
                days.push(translations[currentDay]);
                currentDay = getNextDay(currentDay);
            }
            days.push(translations[endDay]);
        } else {
            days.push(translations[dayRange]);
        }
        
        return days;
    }

    function getNextDay(day) {
        const daysOrder = ['Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'];
        const index = daysOrder.indexOf(day);
        return index === -1 ? day : daysOrder[(index + 1) % daysOrder.length];
    }

    function formatHoursRange(range) {
        const hours = range.split(',').map(hour => hour.trim());
        return hours.map(hour => {
            const [start, end] = hour.split('-');
            return `${start} - ${end}`;
        }).join(', ');
    }

    // Chiama la funzione per ottenere gli orari
    fetchOpeningHours();
    </script>
</body>
</html>

